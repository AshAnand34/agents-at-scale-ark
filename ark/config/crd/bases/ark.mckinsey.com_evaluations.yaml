---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: evaluations.ark.mckinsey.com
spec:
  group: ark.mckinsey.com
  names:
    kind: Evaluation
    listKind: EvaluationList
    plural: evaluations
    singular: evaluation
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.score
      name: Score
      type: string
    - jsonPath: .status.passed
      name: Passed
      type: boolean
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: EvaluationSpec defines the desired state of Evaluation
            properties:
              config:
                description: EvaluationConfig holds type-specific configuration parameters
                properties:
                  evaluations:
                    description: List of evaluations to aggregate
                    items:
                      description: EvaluationRef references an evaluation to aggregate
                        in batch type
                      properties:
                        name:
                          minLength: 1
                          type: string
                        namespace:
                          type: string
                      required:
                      - name
                      type: object
                    type: array
                  input:
                    type: string
                  output:
                    type: string
                  queryRef:
                    description: QueryRef references a query for post-hoc evaluation
                    properties:
                      name:
                        minLength: 1
                        type: string
                      namespace:
                        type: string
                      responseTarget:
                        description: Target name to match against query responses
                          (e.g., "weather-agent", "summary-team")
                        type: string
                    required:
                    - name
                    type: object
                  rules:
                    items:
                      properties:
                        description:
                          description: Description explains what the rule validates
                          type: string
                        expression:
                          description: Expression is a CEL expression that returns
                            a boolean
                          type: string
                        name:
                          description: Name identifies the rule
                          minLength: 1
                          type: string
                        weight:
                          description: 'Weight determines the rule''s impact on the
                            overall score (default: 1)'
                          format: int32
                          minimum: 0
                          type: integer
                      required:
                      - expression
                      - name
                      type: object
                    type: array
                required:
                - input
                - output
                type: object
              evaluator:
                description: EvaluationEvaluatorRef references an evaluator resource
                  for evaluation with parameters
                properties:
                  name:
                    minLength: 1
                    type: string
                  namespace:
                    type: string
                  parameters:
                    items:
                      properties:
                        name:
                          description: Name of the parameter (used as template variable)
                          minLength: 1
                          type: string
                        value:
                          description: Direct value (mutually exclusive with valueFrom)
                          type: string
                        valueFrom:
                          description: Reference to external sources (mutually exclusive
                            with value)
                          properties:
                            configMapKeyRef:
                              description: Selects a key from a ConfigMap.
                              properties:
                                key:
                                  description: The key to select.
                                  type: string
                                name:
                                  default: ""
                                  description: |-
                                    Name of the referent.
                                    This field is effectively required, but due to backwards compatibility is
                                    allowed to be empty. Instances of this type with an empty value here are
                                    almost certainly wrong.
                                    More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                  type: string
                                optional:
                                  description: Specify whether the ConfigMap or its
                                    key must be defined
                                  type: boolean
                              required:
                              - key
                              type: object
                              x-kubernetes-map-type: atomic
                            secretKeyRef:
                              description: SecretKeySelector selects a key of a Secret.
                              properties:
                                key:
                                  description: The key of the secret to select from.  Must
                                    be a valid secret key.
                                  type: string
                                name:
                                  default: ""
                                  description: |-
                                    Name of the referent.
                                    This field is effectively required, but due to backwards compatibility is
                                    allowed to be empty. Instances of this type with an empty value here are
                                    almost certainly wrong.
                                    More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                  type: string
                                optional:
                                  description: Specify whether the Secret or its key
                                    must be defined
                                  type: boolean
                              required:
                              - key
                              type: object
                              x-kubernetes-map-type: atomic
                            serviceRef:
                              properties:
                                name:
                                  description: Name of the service
                                  type: string
                                namespace:
                                  description: Namespace of the service. Defaults
                                    to the namespace as the resource.
                                  type: string
                                path:
                                  description: Optional path to append to the service
                                    address. For models might be 'v1', for gemini
                                    might be 'v1beta/openai', for mcp servers might
                                    be 'mcp'.
                                  type: string
                                port:
                                  description: Port name to use. If not specified,
                                    uses the service's only port or first port.
                                  type: string
                              required:
                              - name
                              type: object
                          type: object
                      required:
                      - name
                      type: object
                    type: array
                required:
                - name
                type: object
              timeout:
                default: 5m
                description: Timeout for query execution (e.g., "30s", "5m", "1h")
                type: string
              ttl:
                default: 720h
                type: string
              type:
                default: direct
                enum:
                - direct
                - baseline
                - query
                - batch
                - event
                type: string
            required:
            - config
            type: object
          status:
            description: EvaluationStatus defines the observed state of Evaluation
            properties:
              duration:
                type: string
              message:
                type: string
              passed:
                type: boolean
              phase:
                enum:
                - pending
                - running
                - error
                - done
                - canceled
                type: string
              score:
                pattern: ^(0(\.[0-9]+)?|1(\.0+)?)$
                type: string
              tokenUsage:
                properties:
                  completionTokens:
                    format: int64
                    type: integer
                  promptTokens:
                    format: int64
                    type: integer
                  totalTokens:
                    format: int64
                    type: integer
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
